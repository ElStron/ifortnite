---
import Section from '@/components/Section.astro';
import Layout from '@/layouts/Layout.astro';
import type { Item } from '@/models/shop.type.ts';
import { getDailyShop, filterItemsBySection } from '@/services/dailyShop.ts'
import { getI18N } from "@/i18n"
const { currentLocale } = Astro
const i18n = getI18N({ currentLocale })

interface Props {
  date?: string;
}
const { date } = Astro.props
const data = await getDailyShop({ lang: currentLocale, date: date });

let seoTitle = i18n.SHOP.TITLE_SEO
let seoDescription = i18n.SHOP.DESCRIPTION_SEO
let title = i18n.SHOP.TITLE
let description = i18n.SHOP.DESCRIPTION
let lastUpdate = data.lastUpdate.date

if (date) {
  seoTitle = i18n.SHOP.BY_DATE.TITLE_SEO.replace("{date}", date)
  seoDescription = i18n.SHOP.BY_DATE.DESCRIPTION_SEO.replace("{date}", date)
  title = i18n.SHOP.BY_DATE.TITLE.replace("{date}", date)
  description = i18n.SHOP.BY_DATE.DESCRIPTION.replace("{date}", date)
  lastUpdate = "";
}


const sections = filterItemsBySection(data.shop);
---
<Layout title={seoTitle} description={seoDescription}>

  <section class="w-full mx-auto p-3 text-balance" id="hero">
    <h1 class="mb-2 text-xl font-extrabold text-gray-900 dark:text-white md:text-2xl lg:text-3xl" set:html={title}>
    </h1>
    <p class="text-[16px] font-normal text-gray-500 dark:text-gray-400 text-pretty">
      {description} <span class="font-bold">{lastUpdate}</span>
    </p>
  </section>

  <section class="w-full mx-auto custom-scrollbar">
    <div class="w-full p-6 flex flex-col gap-8 ">
      {
        sections && sections.map((section) => {
          const dataSection = section.items as Item[]
          return (
            <Section
              id={section.id} 
              shop={dataSection}
              name={section.name} 
            />
          )
        })
      }
    </div>
  </section>
</Layout>

<style is:inline>
  h1>strong {
    background: -webkit-linear-gradient(90deg, #00DBDE 0%, #FC00FF 100%);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-color: #00DBDE;
    background-image: linear-gradient(90deg, #00DBDE 0%, #FC00FF 100%);

  }
    h2 {
    display: block;
    line-height: 1.5; 
    }
  
    article {
        view-timeline-name: --image;
        view-timeline-axis: block;
        animation-timeline: --image;
        animation-name: mymove;
        animation-range: entry 25% cover 55%;
        animation-fill-mode: both;
    }
    @keyframes mymove {
        0% {
            opacity: 0;
        }
        100% {
            opacity: 1;
        }
    }
</style>
<script is:inline>
  document.addEventListener('DOMContentLoaded', () => {
    const imgs = document.querySelectorAll('[data-imgs]');
    const imgExists = {};

    const randomImg = (images) => {
      const imagesArray = images.split(',');
      const img = imagesArray[Math.floor(Math.random() * imagesArray.length)];
      return img;
    }

    const updateImg = () => {
      imgs.forEach((img) => {
        const getImg = randomImg(img.getAttribute('data-imgs'));

        if (!imgExists[getImg]) {
          img.setAttribute('src', getImg);
          imgExists[getImg] = true;
        }
      });
    }

    setInterval(updateImg, 1000);
  });
</script>